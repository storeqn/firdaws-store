<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ŸÖÿπÿ±ÿ∂ ÿßŸÑŸÅÿ±ÿØŸàÿ≥</title>

<!-- ===== PWA / SAFARI ===== -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ŸÖÿπÿ±ÿ∂ ÿßŸÑŸÅÿ±ÿØŸàÿ≥">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<style>
:root{
  --bg:#f6f8fc;
  --card:#ffffff;
  --text:#111;
  --muted:#666;
  --main:#1e66f5;
  --border:#e3e6ef;
  --radius:14px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Tahoma,Arial;
  background:var(--bg);
  color:var(--text);
}

/* ===== HEADER ===== */
header{
  position:sticky;
  top:0;
  z-index:10;
  background:#fff;
  border-bottom:1px solid var(--border);
}
header.compact .cats{display:none}

.top{
  text-align:center;
  padding:12px 10px;
  font-size:20px;
  font-weight:900;
}

.cats{
  display:flex;
  gap:8px;
  padding:8px 10px;
  overflow:auto;
}
.cats div{
  padding:6px 14px;
  border-radius:20px;
  background:#eef1f8;
  font-size:14px;
  cursor:pointer;
  white-space:nowrap;
}
.cats .active{
  background:var(--main);
  color:#fff;
}

/* ===== CONTENT ===== */
.wrap{padding:12px}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:12px;
}

.card{
  background:var(--card);
  border-radius:var(--radius);
  border:1px solid var(--border);
  overflow:hidden;
}
.card img{
  width:100%;
  height:150px;
  object-fit:contain;
  background:#fafafa;
}
.card .p{
  padding:10px;
}
.card h4{
  margin:0;
  font-size:14px;
  line-height:1.4;
}
.price{
  margin-top:6px;
  font-weight:900;
  color:var(--main);
}
.old{
  font-size:12px;
  color:var(--muted);
  text-decoration:line-through;
}
.btns{
  display:flex;
  gap:6px;
  margin-top:8px;
}
.btn{
  flex:1;
  padding:8px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#f1f3fa;
  cursor:pointer;
  font-weight:700;
}
.buy{
  background:var(--main);
  color:#fff;
  border:none;
}

/* ===== PRODUCT MODAL ===== */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  z-index:20;
}
.modal{
  position:fixed;
  bottom:0;
  left:0;right:0;
  background:#fff;
  border-radius:20px 20px 0 0;
  max-height:85vh;
  overflow:auto;
  padding:14px;
  display:none;
  z-index:30;
}
.modal img{
  width:100%;
  max-height:220px;
  object-fit:contain;
}

/* ===== CART BUTTON ===== */
.cartBtn{
  position:fixed;
  bottom:16px;
  left:16px;
  background:var(--main);
  color:#fff;
  padding:14px 18px;
  border-radius:30px;
  font-weight:900;
  cursor:pointer;
  z-index:15;
}
</style>
</head>

<body>

<header id="head">
  <div class="top">ŸÖÿπÿ±ÿ∂ ÿßŸÑŸÅÿ±ÿØŸàÿ≥</div>
  <div class="cats" id="cats"></div>
</header>

<div class="wrap">
  <div class="grid" id="grid"></div>
</div>

<div class="cartBtn" onclick="sendWhats()">üõí ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®</div>

<!-- PRODUCT MODAL -->
<div class="overlay" id="ov" onclick="closeProd()"></div>
<div class="modal" id="pm"></div>

<script>
const SHEET="https://docs.google.com/spreadsheets/d/e/2PACX-1vToXcV323xvYtiuz6tg-d0q_f2iwOwnYBpCRqAgSnarQ2PYVZ9Z1GJKlSmftjuajtlJ6zBfmVbRwArp/pub?output=csv";
const WA="9647719183122";

let products=[],cart={},cat="";

fetch(SHEET).then(r=>r.text()).then(t=>{
  const l=t.trim().split(/\\r?\\n/);
  const h=l[0].split(",");
  products=l.slice(1).map(r=>{
    const c=r.split(",");
    let o={};h.forEach((x,i)=>o[x]=c[i]||"");
    return o;
  }).filter(p=>p.id && p.name && p.price);
  drawCats();draw();
});

function drawCats(){
  const cs=[...new Set(products.map(p=>p.category))];
  cats.innerHTML='<div class="active" onclick="setCat(\\'\\')">ÿßŸÑŸÉŸÑ</div>';
  cs.forEach(x=>{
    cats.innerHTML+=`<div onclick="setCat('${x}')">${x}</div>`;
  });
}
function setCat(x){
  cat=x;
  [...cats.children].forEach(d=>d.classList.remove("active"));
  event.target.classList.add("active");
  draw();
}

function draw(){
  grid.innerHTML="";
  products.filter(p=>!cat||p.category==cat).forEach(p=>{
    grid.innerHTML+=`
    <div class="card">
      <img src="${p.image}" onclick="openProd('${p.id}')">
      <div class="p">
        <h4>${p.name}</h4>
        <div class="price">${p.price} ÿØ.ÿπ</div>
        ${p.old_price&&p.old_price!=p.price?`<div class="old">${p.old_price}</div>`:""}
        <div class="btns">
          <button class="btn" onclick="add('${p.id}')">ÿ•ÿ∂ÿßŸÅÿ©</button>
          <button class="btn buy" onclick="openProd('${p.id}')">ÿπÿ±ÿ∂</button>
        </div>
      </div>
    </div>`;
  });
}

function openProd(id){
  const p=products.find(x=>x.id==id);
  pm.innerHTML=`
    <img src="${p.image}">
    <h2>${p.name}</h2>
    <p>${p.desc||""}</p>
    <b style="color:var(--main);font-size:18px">${p.price} ÿØ.ÿπ</b>
    <br><br>
    <button class="btn buy" onclick="add('${p.id}')">ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ≥ŸÑÿ©</button>
  `;
  ov.style.display="block";
  pm.style.display="block";
}
function closeProd(){
  ov.style.display="none";
  pm.style.display="none";
}
function add(id){
  cart[id]=(cart[id]||0)+1;
  alert("ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©");
}
function sendWhats(){
  let msg="ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ ŸÖŸÜ ŸÖÿπÿ±ÿ∂ ÿßŸÑŸÅÿ±ÿØŸàÿ≥%0A";
  for(let id in cart){
    let p=products.find(x=>x.id==id);
    msg+=`${p.name} √ó ${cart[id]}%0A`;
  }
  window.open(`https://wa.me/${WA}?text=${msg}`);
}

window.addEventListener("scroll",()=>{
  head.classList.toggle("compact",window.scrollY>60);
});
</script>

</body>
</html>
