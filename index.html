<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ŸÖÿπÿ±ÿ∂ ÿßŸÑŸÅÿ±ÿØŸàÿ≥</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<style>
:root{
  --bg:#0b0d12;
  --card:#141824;
  --text:#fff;
  --muted:#aaa;
  --main:#2d7dff;
  --radius:16px;
}
body.light{
  --bg:#f5f6fa;
  --card:#fff;
  --text:#111;
  --muted:#555;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Tahoma;
  background:var(--bg);
  color:var(--text);
}

/* ===== HEADER ===== */
header{
  position:sticky;
  top:0;
  z-index:10;
  background:rgba(0,0,0,.8);
  backdrop-filter:blur(10px);
  border-bottom:1px solid #333;
}
header.compact .cats{display:none}

.top{
  display:flex;
  align-items:center;
  justify-content:center;
  padding:10px;
}
.logo{
  font-size:20px;
  font-weight:900;
}
.actions{
  position:absolute;
  left:10px;
  display:flex;
  gap:6px;
}
.actions button{
  background:none;
  border:1px solid #444;
  color:var(--text);
  border-radius:10px;
  padding:6px 10px;
  cursor:pointer;
}

.cats{
  display:flex;
  gap:6px;
  padding:6px 10px;
  overflow:auto;
}
.cats div{
  padding:6px 12px;
  border-radius:20px;
  background:#222;
  white-space:nowrap;
  cursor:pointer;
}
.cats .active{background:var(--main)}

/* ===== CONTENT ===== */
.wrap{padding:12px}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:10px;
}
.card{
  background:var(--card);
  border-radius:var(--radius);
  overflow:hidden;
}
.card img{
  width:100%;
  height:140px;
  object-fit:contain;
  background:#000;
}
.card .p{padding:8px}
.card h4{margin:0;font-size:14px}
.price{font-weight:900;margin-top:6px}
.old{text-decoration:line-through;color:var(--muted);font-size:12px}
.btns{display:flex;gap:6px;margin-top:6px}
.btn{
  flex:1;
  border:none;
  border-radius:10px;
  padding:8px;
  cursor:pointer;
  font-weight:700;
}
.buy{background:var(--main);color:#fff}
.add{background:#333;color:#fff}

/* ===== PRODUCT MODAL ===== */
.overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  z-index:20;
}
.modal{
  position:fixed;
  bottom:0;
  left:0;right:0;
  background:var(--bg);
  border-radius:20px 20px 0 0;
  max-height:85vh;
  overflow:auto;
  padding:12px;
  display:none;
  z-index:30;
}
.modal img{
  width:100%;
  max-height:220px;
  object-fit:contain;
}

/* ===== CART ===== */
.cartBtn{
  position:fixed;
  bottom:15px;
  left:15px;
  background:var(--main);
  color:#fff;
  padding:12px 16px;
  border-radius:30px;
  font-weight:900;
  cursor:pointer;
  z-index:15;
}
</style>
</head>

<body>

<header id="head">
  <div class="top">
    <div class="actions">
      <button onclick="toggleTheme()">üåì</button>
    </div>
    <div class="logo">ŸÖÿπÿ±ÿ∂ ÿßŸÑŸÅÿ±ÿØŸàÿ≥</div>
  </div>
  <div class="cats" id="cats"></div>
</header>

<div class="wrap">
  <div class="grid" id="grid"></div>
</div>

<div class="cartBtn" onclick="sendWhats()">üõí ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®</div>

<!-- PRODUCT MODAL -->
<div class="overlay" id="ov" onclick="closeProd()"></div>
<div class="modal" id="pm"></div>

<script>
const SHEET="https://docs.google.com/spreadsheets/d/e/2PACX-1vToXcV323xvYtiuz6tg-d0q_f2iwOwnYBpCRqAgSnarQ2PYVZ9Z1GJKlSmftjuajtlJ6zBfmVbRwArp/pub?output=csv";
const WA="9647719183122";
let products=[],cart={},cat="";

fetch(SHEET).then(r=>r.text()).then(t=>{
  const l=t.trim().split(/\r?\n/);
  const h=l[0].split(",");
  products=l.slice(1).map(r=>{
    const c=r.split(",");
    let o={};h.forEach((x,i)=>o[x]=c[i]||"");
    return o;
  });
  drawCats();draw();
});

function drawCats(){
  const cs=[...new Set(products.map(p=>p.category))];
  const c=document.getElementById("cats");
  c.innerHTML='<div class="active" onclick="setCat(\'\')">ÿßŸÑŸÉŸÑ</div>';
  cs.forEach(x=>{
    c.innerHTML+=`<div onclick="setCat('${x}')">${x}</div>`;
  });
}
function setCat(x){cat=x;draw();}

function draw(){
  const g=document.getElementById("grid");
  g.innerHTML="";
  products.filter(p=>!cat||p.category==cat).forEach(p=>{
    g.innerHTML+=`
    <div class="card">
      <img src="${p.image}" onclick="openProd('${p.id}')">
      <div class="p">
        <h4>${p.name}</h4>
        <div class="price">${p.price} ÿØ.ÿπ</div>
        ${p.old_price&&p.old_price!=p.price?`<div class="old">${p.old_price}</div>`:""}
        <div class="btns">
          <button class="btn add" onclick="add('${p.id}')">ÿ•ÿ∂ÿßŸÅÿ©</button>
          <button class="btn buy" onclick="openProd('${p.id}')">ÿπÿ±ÿ∂</button>
        </div>
      </div>
    </div>`;
  });
}

function openProd(id){
  const p=products.find(x=>x.id==id);
  document.getElementById("pm").innerHTML=`
    <img src="${p.image}">
    <h2>${p.name}</h2>
    <p>${p.desc}</p>
    <b>${p.price} ÿØ.ÿπ</b>
    <br><br>
    <button class="btn buy" onclick="add('${p.id}')">ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ≥ŸÑÿ©</button>
  `;
  document.getElementById("ov").style.display="block";
  document.getElementById("pm").style.display="block";
}
function closeProd(){
  ov.style.display="none";
  pm.style.display="none";
}

function add(id){cart[id]=(cart[id]||0)+1;alert("ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©");}

function sendWhats(){
  let msg="ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ%0A";
  for(let id in cart){
    let p=products.find(x=>x.id==id);
    msg+=`${p.name} x${cart[id]}%0A`;
  }
  window.open(`https://wa.me/${WA}?text=${msg}`);
}

function toggleTheme(){
  document.body.classList.toggle("light");
  localStorage.setItem("theme",document.body.classList.contains("light")?"l":"d");
}
if(localStorage.getItem("theme")=="l")document.body.classList.add("light");

window.addEventListener("scroll",()=>{
  head.classList.toggle("compact",window.scrollY>60);
});
</script>
</body>
</html>
